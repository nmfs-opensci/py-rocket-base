<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Developer notes – py-rocket-base documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./jupyter-config.html" rel="prev">
<link href="./assets/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./developers.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Developer notes</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="https://raw.githubusercontent.com/nmfs-opensci/assets/main/logo/nmfs-opensci-logo3.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">py-rocket-base documentation</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://nmfs-opensci.github.io" title="NMFS Open Science" class="quarto-navigation-tool px-1" aria-label="NMFS Open Science"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/nmfs-opensci/py-rocket-base" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./customizing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Using py-rocket-base</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./configuration_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Configuration files</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R packages</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./desktop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Desktop</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Creating PDFs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jupyter-config.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Customizing Jupyter</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./developers.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Developer notes</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#design" id="toc-design" class="nav-link active" data-scroll-target="#design"><span class="header-section-number">7.1</span> Design</a></li>
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation"><span class="header-section-number">7.2</span> Documentation</a></li>
  <li><a href="#building-the-images" id="toc-building-the-images" class="nav-link" data-scroll-target="#building-the-images"><span class="header-section-number">7.3</span> Building the images</a></li>
  <li><a href="#repo2docker" id="toc-repo2docker" class="nav-link" data-scroll-target="#repo2docker"><span class="header-section-number">7.4</span> repo2docker</a>
  <ul class="collapse">
  <li><a href="#copy" id="toc-copy" class="nav-link" data-scroll-target="#copy"><span class="header-section-number">7.4.1</span> COPY</a></li>
  <li><a href="#env-and-args" id="toc-env-and-args" class="nav-link" data-scroll-target="#env-and-args"><span class="header-section-number">7.4.2</span> ENV and ARGS</a></li>
  </ul></li>
  <li><a href="#rstudio" id="toc-rstudio" class="nav-link" data-scroll-target="#rstudio"><span class="header-section-number">7.5</span> RStudio</a>
  <ul class="collapse">
  <li><a href="#environmental-variables" id="toc-environmental-variables" class="nav-link" data-scroll-target="#environmental-variables"><span class="header-section-number">7.5.1</span> Environmental variables</a></li>
  </ul></li>
  <li><a href="#basic-structure-of-py-rocket-base" id="toc-basic-structure-of-py-rocket-base" class="nav-link" data-scroll-target="#basic-structure-of-py-rocket-base"><span class="header-section-number">7.6</span> Basic structure of py-rocket-base</a>
  <ul class="collapse">
  <li><a href="#apt2.txt" id="toc-apt2.txt" class="nav-link" data-scroll-target="#apt2.txt"><span class="header-section-number">7.6.1</span> apt2.txt</a></li>
  <li><a href="#environment.yml" id="toc-environment.yml" class="nav-link" data-scroll-target="#environment.yml"><span class="header-section-number">7.6.2</span> environment.yml</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">7.6.3</span> appendix</a></li>
  </ul></li>
  <li><a href="#rocker.sh" id="toc-rocker.sh" class="nav-link" data-scroll-target="#rocker.sh"><span class="header-section-number">7.7</span> rocker.sh</a></li>
  <li><a href="#start" id="toc-start" class="nav-link" data-scroll-target="#start"><span class="header-section-number">7.8</span> start</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/nmfs-opensci/py-rocket-base/edit/main/developers.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/nmfs-opensci/py-rocket-base/blob/main/developers.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/nmfs-opensci/py-rocket-base/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Developer notes</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="design" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="design"><span class="header-section-number">7.1</span> Design</h2>
<p>py-rocket-base is inspired by <a href="https://github.com/jupyterhub/repo2docker">repo2docker</a> and the <a href="https://pangeo-docker-images.readthedocs.io/en/latest/">Pangeo Docker stack</a> design. py-rocker-base is built using repo2docker (via <a href="https://github.com/jupyterhub/repo2docker-action">repo2docker-action</a>) and thus lets repo2docker make the choices regarding the environment design—things like how the conda environment is set-up and the base directory structure and permissions.</p>
<p>The Pangeo Docker stack does not use repo2docker, but mimics repo2docker’s environment design. The Pangeo base-image behaves similar to repo2docker in that using the base-image in the <code>FROM</code> line of a Dockerfile causes the build to look for files with the same names as repo2docker’s <a href="https://repo2docker.readthedocs.io/en/latest/config_files.html">configuration files</a> and then do the proper action with those files. This means that routine users do not need to know how to write Dockerfile code in order to extend the image with new packages or applications. py-rocker-base Docker image uses this Pangeo base-image design. It is based on <code>ONBUILD</code> commands in the Dockerfile that trigger actions only when the image is used in the <code>FROM</code> line of another Dockerfile.</p>
<p><em>There are many ways to install R and RStudio into an image designed for JupyterHubs</em> The objective of py-rocker-base is not to install R and RStudio, per se, and there are other leaner and faster ways to install R/RStudio if that is your goal<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. The objective of py-rocket-base is to create an JupyterHub image such when you click the RStudio button in the JupyterLab UI to enter the RStudio UI, you enter an environment that is the same as if you had used a Rocker image. If you are in the JupyterLab UI, the environment is the same as it you had used repo2docker (or Pangeo base-image) to create the environment.</p>
<aside id="footnotes" class="footnotes footnotes-end-of-block" role="doc-footnote">
<ol>
<li id="fn1"><p>See for example <a href="https://github.com/boettiger-lab/repo2docker-r">repo2docker-r</a> and <a href="https://github.com/binder-examples/r-conda">conda-r</a> in <a href="https://github.com/binder-examples">binder-examples</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>
</section>
<section id="documentation" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="documentation"><span class="header-section-number">7.2</span> Documentation</h2>
<p>To build the documentation book, clone repo and then</p>
<pre><code>cd book
quarto render .</code></pre>
<p>Set GitHub Pages to docs folder.</p>
</section>
<section id="building-the-images" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="building-the-images"><span class="header-section-number">7.3</span> Building the images</h2>
<p>The <code>.github/workflows/build.yaml</code> is a GitHub Action to build the image with <a href="https://github.com/jupyterhub/repo2docker-action">repo2docker-action</a>. The GitHub Action builds the image and the URL will look like one of these</p>
<pre><code>ghcr.io/nmfs-opensci/repo-name/image-name:latest
ghcr.io/nmfs-opensci/image-name:latest</code></pre>
<p>For example, for this repo the image is <code>ghcr.io/nmfs-opensci/py-rocket-base:latest</code>.</p>
</section>
<section id="repo2docker" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="repo2docker"><span class="header-section-number">7.4</span> repo2docker</h2>
<p><a href="https://github.com/jupyterhub/repo2docker-action">repo2docker-action</a> is creating the image and publishing to <code>ghcr.io/nmfs-opensci/py-rocket-base</code> (image hosting like dockerhub or quay.io).</p>
<p><a href="https://github.com/jupyterhub/repo2docker">repo2docker</a> (a python package) sets up the structure of the base environment, e.g.&nbsp;installs mamba for package solving, sets up environment variables, installs linux packages, etc. It looks for specific files (like apt.txt, environment.yml, postBuild) in the build context (the repo that the Dockerfile is in) and takes the appropriate action. repo2docker-action also allows you to include <code>appendix</code> to add more commands to your Dockerfile.</p>
<p>repo2docker does a lot behind the scene and has some different behavior.</p>
<section id="copy" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="copy"><span class="header-section-number">7.4.1</span> COPY</h3>
<p><code>COPY &lt;src&gt; &lt;dest&gt;</code> does not work in <code>appendix</code> because repo2docker changes the build context. The files are in <code>src</code> not <code>.</code>. In appendix, you do not do lines like this</p>
<pre><code>COPY file1 newlocation/file1</code></pre>
<p>to bring file1 into the build. Instead, the files are already in <code>${REPO_DIR}/</code>. If you want to copy a file to a new location, run the following as root if jovyan does not have permission to write to <code>newlocation</code>.</p>
<pre><code>RUN cp ${REPO_DIR}/file1 newlocation/file1</code></pre>
</section>
<section id="env-and-args" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="env-and-args"><span class="header-section-number">7.4.2</span> ENV and ARGS</h3>
<p>repo2docker uses a number of ARGs in the build which you might expect to be in the image environment, for example <code>${NB_USER}</code>. These need to be converted to ENV to be available to child builds.</p>
</section>
</section>
<section id="rstudio" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="rstudio"><span class="header-section-number">7.5</span> RStudio</h2>
<p><a href="https://github.com/jupyterhub/jupyter-rsession-proxy">jupyter-rsession-proxy</a> allows us to launch RStudio from Jupyter Lab, but the environment is different than the environment in Jupyter Lab.</p>
<section id="environmental-variables" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="environmental-variables"><span class="header-section-number">7.5.1</span> Environmental variables</h3>
<ul>
<li>PATH is different. conda is not on the path.</li>
<li>None of the environmental variables in the docker file will be in the <code>/rstudio</code> environment. The start command affects <code>\lab</code> and <code>\notebook</code> but not <code>\rstudio</code>.</li>
<li>The path in the terminal (in RStudio) can/is different than in the R console. Expect weird unexpected behavior because of this. If you type <code>bash</code>, then <code>.bashrc</code> is run and that will run <code>conda init</code> and that will add conda binaries to the path. Then really weird and unexpected things can happen.</li>
</ul>
<p>If you need some environmental variable set, you will need to set those in <code>$R_HOME/etc/Rprofile.site</code> which is run when R starts.</p>
</section>
</section>
<section id="basic-structure-of-py-rocket-base" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="basic-structure-of-py-rocket-base"><span class="header-section-number">7.6</span> Basic structure of py-rocket-base</h2>
<p>The py-rocket-base docker build has the following structure:</p>
<pre><code># base image and environment
repo2docker sets this up
repo2docker-action sets the directory where the build files 
  are put to /srv/repo (via $REPO_DIR in GitHub Action)
  and ownership is set to jovyan (via $NB_USER)
  
# environment.yml
repo2docker adds these packages to the conda notebook environment

# start
repo2docker points the Docker image entrypoint (command run on start) to this file
${REPO_DIR}/start

# appendix
repo2docker-action adds the Docker commands here to the end of Dockerfile
most of the work in py-rocket-base is done here. appendix calls rocker.sh and install packages in apt2.txt</code></pre>
<p>Each file is described below.</p>
<section id="apt2.txt" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1" class="anchored" data-anchor-id="apt2.txt"><span class="header-section-number">7.6.1</span> apt2.txt</h3>
<p>This is not named <code>apt.txt</code> because these packages need to be installed after R is installed because the R scripts uninstall packages as part of cleanup. There are some packages that are required for Desktop (<code>/desktop</code>) to operate correctly. Packages needed for R and RStudio building (<code>/rstudio</code>) are installed via the rocker install scripts.</p>
</section>
<section id="environment.yml" class="level3" data-number="7.6.2">
<h3 data-number="7.6.2" class="anchored" data-anchor-id="environment.yml"><span class="header-section-number">7.6.2</span> environment.yml</h3>
<p>These are added to the notebook conda environment and in py-rocket-base the basic packages needed for Jupyter Lab, RStudio and Desktop are added. Scientific packages are not added here. They will be added via child images that use py-rocket-base as the base image (in the FROM line).</p>
</section>
<section id="appendix" class="level3" data-number="7.6.3">
<h3 data-number="7.6.3" class="anchored" data-anchor-id="appendix"><span class="header-section-number">7.6.3</span> appendix</h3>
<p>This a long file with many pieces. The pieces are explained below. Click on the number next to code to read about what that code block does.</p>
<div class="sourceCode" id="annotated-cell-6"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-1" class="code-annotation-target"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>USER root</span>
<span id="annotated-cell-6-2"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># repo2docker does not set this. This is the default env in repo2docker type images</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2">2</button><span id="annotated-cell-6-4" class="code-annotation-target"><a href="#annotated-cell-6-4" aria-hidden="true" tabindex="-1"></a>ENV CONDA_ENV<span class="ot">=</span>notebook</span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-6"><a href="#annotated-cell-6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Install R, RStudio via Rocker scripts</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3">3</button><span id="annotated-cell-6-7" class="code-annotation-target"><a href="#annotated-cell-6-7" aria-hidden="true" tabindex="-1"></a>ENV R_VERSION<span class="ot">=</span><span class="st">"4.4.1"</span></span>
<span id="annotated-cell-6-8"><a href="#annotated-cell-6-8" aria-hidden="true" tabindex="-1"></a>ENV R_DOCKERFILE<span class="ot">=</span><span class="st">"verse_${R_VERSION}"</span></span>
<span id="annotated-cell-6-9"><a href="#annotated-cell-6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This is in the rocker script but will not run since ${NB_USER} already exists</span></span>
<span id="annotated-cell-6-10"><a href="#annotated-cell-6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Needed because rocker scripts set permissions based on the staff group</span></span>
<span id="annotated-cell-6-11"><a href="#annotated-cell-6-11" aria-hidden="true" tabindex="-1"></a>RUN usermod <span class="sc">-</span>a <span class="sc">-</span>G staff <span class="st">"${NB_USER}"</span></span>
<span id="annotated-cell-6-12"><a href="#annotated-cell-6-12" aria-hidden="true" tabindex="-1"></a>RUN PATH<span class="ot">=</span><span class="er">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>sbin<span class="sc">:</span><span class="er">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>bin<span class="sc">:</span><span class="er">/</span>usr<span class="sc">/</span>sbin<span class="sc">:</span><span class="er">/</span>usr<span class="sc">/</span>bin<span class="sc">:</span><span class="er">/</span>sbin<span class="sc">:</span><span class="er">/</span>bin <span class="sc">&amp;&amp;</span> \</span>
<span id="annotated-cell-6-13"><a href="#annotated-cell-6-13" aria-hidden="true" tabindex="-1"></a>  chmod <span class="sc">+</span>x <span class="sc">$</span>{REPO_DIR}<span class="sc">/</span>rocker.sh <span class="sc">&amp;&amp;</span> \</span>
<span id="annotated-cell-6-14"><a href="#annotated-cell-6-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">$</span>{REPO_DIR}<span class="sc">/</span>rocker.sh</span>
<span id="annotated-cell-6-15"><a href="#annotated-cell-6-15" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="4">4</button><span id="annotated-cell-6-16" class="code-annotation-target"><a href="#annotated-cell-6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Install linux packages after R installation since the R install scripts get rid of packages</span></span>
<span id="annotated-cell-6-17"><a href="#annotated-cell-6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># The package_list part is reading the file and doing clean-up to just have the list of packages</span></span>
<span id="annotated-cell-6-18"><a href="#annotated-cell-6-18" aria-hidden="true" tabindex="-1"></a>RUN package_list<span class="ot">=</span><span class="er">$</span>(grep <span class="sc">-</span>v <span class="st">'^\s*#'</span> <span class="sc">$</span>{REPO_DIR}<span class="sc">/</span>apt2.txt <span class="sc">|</span> grep <span class="sc">-</span>v <span class="st">'^\s*$'</span> <span class="sc">|</span> sed <span class="st">'s/</span><span class="sc">\r</span><span class="st">//g; s/#.*//; s/^[[:space:]]*//; s/[[:space:]]*$//'</span> <span class="sc">|</span> awk <span class="st">'{$1=$1};1'</span>) <span class="sc">&amp;&amp;</span> \</span>
<span id="annotated-cell-6-19"><a href="#annotated-cell-6-19" aria-hidden="true" tabindex="-1"></a>  apt<span class="sc">-</span>get update <span class="sc">&amp;&amp;</span> \</span>
<span id="annotated-cell-6-20"><a href="#annotated-cell-6-20" aria-hidden="true" tabindex="-1"></a>  apt<span class="sc">-</span>get install <span class="sc">--</span>yes <span class="sc">--</span>no<span class="sc">-</span>install<span class="sc">-</span>recommends <span class="sc">$</span>package_list <span class="sc">&amp;&amp;</span> \</span>
<span id="annotated-cell-6-21"><a href="#annotated-cell-6-21" aria-hidden="true" tabindex="-1"></a>  apt<span class="sc">-</span>get autoremove <span class="sc">--</span>purge <span class="sc">&amp;&amp;</span> \</span>
<span id="annotated-cell-6-22"><a href="#annotated-cell-6-22" aria-hidden="true" tabindex="-1"></a>  apt<span class="sc">-</span>get clean <span class="sc">&amp;&amp;</span> \</span>
<span id="annotated-cell-6-23"><a href="#annotated-cell-6-23" aria-hidden="true" tabindex="-1"></a>  rm <span class="sc">-</span>rf <span class="sc">/</span>var<span class="sc">/</span>lib<span class="sc">/</span>apt<span class="sc">/</span>lists<span class="sc">/</span><span class="er">*</span></span>
<span id="annotated-cell-6-24"><a href="#annotated-cell-6-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-6-25"><a href="#annotated-cell-6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-enable man pages disabled in Ubuntu 18 minimal image</span></span>
<span id="annotated-cell-6-26"><a href="#annotated-cell-6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># https://wiki.ubuntu.com/Minimal</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="5">5</button><span id="annotated-cell-6-27" class="code-annotation-target"><a href="#annotated-cell-6-27" aria-hidden="true" tabindex="-1"></a>RUN yes <span class="sc">|</span> unminimize</span>
<span id="annotated-cell-6-28"><a href="#annotated-cell-6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: $NB_PYTHON_PREFIX is the same as $CONDA_PREFIX at run-time.</span></span>
<span id="annotated-cell-6-29"><a href="#annotated-cell-6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># $CONDA_PREFIX isn't available in this context.</span></span>
<span id="annotated-cell-6-30"><a href="#annotated-cell-6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: Prepending ensures a working path; if $MANPATH was previously empty,</span></span>
<span id="annotated-cell-6-31"><a href="#annotated-cell-6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># the trailing colon ensures that system paths are searched.</span></span>
<span id="annotated-cell-6-32"><a href="#annotated-cell-6-32" aria-hidden="true" tabindex="-1"></a>ENV MANPATH<span class="ot">=</span><span class="st">"${NB_PYTHON_PREFIX}/share/man:${MANPATH}"</span></span>
<span id="annotated-cell-6-33"><a href="#annotated-cell-6-33" aria-hidden="true" tabindex="-1"></a>RUN mandb</span>
<span id="annotated-cell-6-34"><a href="#annotated-cell-6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-35"><a href="#annotated-cell-6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Add custom jupyter config. You can also put config.py files in the same place</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="6">6</button><span id="annotated-cell-6-36" class="code-annotation-target"><a href="#annotated-cell-6-36" aria-hidden="true" tabindex="-1"></a>COPY custom_jupyter_server_config.json <span class="sc">$</span>{NB_PYTHON_PREFIX}<span class="sc">/</span>etc<span class="sc">/</span>jupyter<span class="sc">/</span>jupyter_server_config.d<span class="sc">/</span></span>
<span id="annotated-cell-6-37"><a href="#annotated-cell-6-37" aria-hidden="true" tabindex="-1"></a>COPY custom_jupyter_server_config.json <span class="sc">$</span>{NB_PYTHON_PREFIX}<span class="sc">/</span>etc<span class="sc">/</span>jupyter<span class="sc">/</span>jupyter_notebook_config.d<span class="sc">/</span></span>
<span id="annotated-cell-6-38"><a href="#annotated-cell-6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-39"><a href="#annotated-cell-6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up extra files in ${REPO_DIR}</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="7">7</button><span id="annotated-cell-6-40" class="code-annotation-target"><a href="#annotated-cell-6-40" aria-hidden="true" tabindex="-1"></a>RUN rm <span class="sc">-</span>rf <span class="sc">$</span>{REPO_DIR}<span class="sc">/</span>book <span class="sc">$</span>{REPO_DIR}<span class="sc">/</span>docs</span>
<span id="annotated-cell-6-41"><a href="#annotated-cell-6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-42"><a href="#annotated-cell-6-42" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="annotated-cell-6-43"><a href="#annotated-cell-6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up behavior for child dockerfiles</span></span>
<span id="annotated-cell-6-44"><a href="#annotated-cell-6-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert NB_USER to ENV (from ARG) so that it passes to the child dockerfile</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="8">8</button><span id="annotated-cell-6-45" class="code-annotation-target"><a href="#annotated-cell-6-45" aria-hidden="true" tabindex="-1"></a>ENV NB_USER<span class="ot">=</span><span class="er">$</span>{NB_USER}</span>
<span id="annotated-cell-6-46"><a href="#annotated-cell-6-46" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="9">9</button><span id="annotated-cell-6-47" class="code-annotation-target"><a href="#annotated-cell-6-47" aria-hidden="true" tabindex="-1"></a><span class="do">## ONBUILD section. These commands are run in child Dockerfiles. These are run right after the FROM image is loaded</span></span>
<span id="annotated-cell-6-48"><a href="#annotated-cell-6-48" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="10">10</button><span id="annotated-cell-6-49" class="code-annotation-target"><a href="#annotated-cell-6-49" aria-hidden="true" tabindex="-1"></a>ONBUILD USER <span class="sc">$</span>{NB_USER}</span>
<span id="annotated-cell-6-50"><a href="#annotated-cell-6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-51"><a href="#annotated-cell-6-51" aria-hidden="true" tabindex="-1"></a><span class="co"># ${REPO_DIR} is owned by ${NB_USER}</span></span>
<span id="annotated-cell-6-52"><a href="#annotated-cell-6-52" aria-hidden="true" tabindex="-1"></a><span class="co"># copy all the files in the repo (i.e. ".") into ${REPO_DIR}</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="11">11</button><span id="annotated-cell-6-53" class="code-annotation-target"><a href="#annotated-cell-6-53" aria-hidden="true" tabindex="-1"></a>ONBUILD COPY <span class="sc">--</span>chown<span class="ot">=</span><span class="er">$</span>{NB_USER}<span class="sc">:</span><span class="er">$</span>{NB_USER} . <span class="sc">$</span>{REPO_DIR}<span class="sc">/</span>childimage</span>
<span id="annotated-cell-6-54"><a href="#annotated-cell-6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-55"><a href="#annotated-cell-6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-56"><a href="#annotated-cell-6-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy Desktop files into ${REPO_DIR}/Desktop if they exist. start will copy to Application dir and Desktop</span></span>
<span id="annotated-cell-6-57"><a href="#annotated-cell-6-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Will not fail if Desktop dir exists but is empty</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="13">13</button><span id="annotated-cell-6-58" class="code-annotation-target"><a href="#annotated-cell-6-58" aria-hidden="true" tabindex="-1"></a>ONBUILD RUN echo <span class="st">"Checking for 'Desktop directory'..."</span> \</span>
<span id="annotated-cell-6-59"><a href="#annotated-cell-6-59" aria-hidden="true" tabindex="-1"></a>        ; cd <span class="st">"${REPO_DIR}/childimage/"</span> \</span>
<span id="annotated-cell-6-60"><a href="#annotated-cell-6-60" aria-hidden="true" tabindex="-1"></a>        ; <span class="cf">if</span> test <span class="sc">-</span>d Desktop ; then \</span>
<span id="annotated-cell-6-61"><a href="#annotated-cell-6-61" aria-hidden="true" tabindex="-1"></a>            mkdir <span class="sc">-</span>p <span class="st">"${REPO_DIR}/Desktop"</span> <span class="sc">&amp;&amp;</span> \</span>
<span id="annotated-cell-6-62"><a href="#annotated-cell-6-62" aria-hidden="true" tabindex="-1"></a>            [ <span class="st">"$(ls -A Desktop 2&gt;/dev/null)"</span> ] <span class="sc">&amp;&amp;</span> cp <span class="sc">-</span>r Desktop<span class="sc">/</span><span class="er">*</span> <span class="st">"${REPO_DIR}/Desktop/"</span>; \</span>
<span id="annotated-cell-6-63"><a href="#annotated-cell-6-63" aria-hidden="true" tabindex="-1"></a>        fi</span>
<span id="annotated-cell-6-64"><a href="#annotated-cell-6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-65"><a href="#annotated-cell-6-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Install apt packages specified in a apt.txt file if it exists.</span></span>
<span id="annotated-cell-6-66"><a href="#annotated-cell-6-66" aria-hidden="true" tabindex="-1"></a><span class="co"># blank lines and comments are supported in apt.txt</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="14">14</button><span id="annotated-cell-6-67" class="code-annotation-target"><a href="#annotated-cell-6-67" aria-hidden="true" tabindex="-1"></a>ONBUILD USER root</span>
<span id="annotated-cell-6-68"><a href="#annotated-cell-6-68" aria-hidden="true" tabindex="-1"></a>ONBUILD RUN echo <span class="st">"Checking for 'apt.txt'..."</span> \</span>
<span id="annotated-cell-6-69"><a href="#annotated-cell-6-69" aria-hidden="true" tabindex="-1"></a>        ; cd <span class="st">"${REPO_DIR}/childimage/"</span> \</span>
<span id="annotated-cell-6-70"><a href="#annotated-cell-6-70" aria-hidden="true" tabindex="-1"></a>        ; <span class="cf">if</span> test <span class="sc">-</span>f <span class="st">"apt.txt"</span> ; then \</span>
<span id="annotated-cell-6-71"><a href="#annotated-cell-6-71" aria-hidden="true" tabindex="-1"></a>        package_list<span class="ot">=</span><span class="er">$</span>(grep <span class="sc">-</span>v <span class="st">'^\s*#'</span> apt.txt <span class="sc">|</span> grep <span class="sc">-</span>v <span class="st">'^\s*$'</span> <span class="sc">|</span> sed <span class="st">'s/</span><span class="sc">\r</span><span class="st">//g; s/#.*//; s/^[[:space:]]*//; s/[[:space:]]*$//'</span> <span class="sc">|</span> awk <span class="st">'{$1=$1};1'</span>) \</span>
<span id="annotated-cell-6-72"><a href="#annotated-cell-6-72" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> apt<span class="sc">-</span>get update <span class="sc">--</span>fix<span class="sc">-</span>missing <span class="sc">&gt;</span> <span class="er">/</span>dev<span class="sc">/</span>null \</span>
<span id="annotated-cell-6-73"><a href="#annotated-cell-6-73" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> apt<span class="sc">-</span>get install <span class="sc">--</span>yes <span class="sc">--</span>no<span class="sc">-</span>install<span class="sc">-</span>recommends <span class="sc">$</span>package_list \</span>
<span id="annotated-cell-6-74"><a href="#annotated-cell-6-74" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> apt<span class="sc">-</span>get autoremove <span class="sc">--</span>purge \</span>
<span id="annotated-cell-6-75"><a href="#annotated-cell-6-75" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> apt<span class="sc">-</span>get clean \</span>
<span id="annotated-cell-6-76"><a href="#annotated-cell-6-76" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> rm <span class="sc">-</span>rf <span class="sc">/</span>var<span class="sc">/</span>lib<span class="sc">/</span>apt<span class="sc">/</span>lists<span class="sc">/</span><span class="er">*</span> \</span>
<span id="annotated-cell-6-77"><a href="#annotated-cell-6-77" aria-hidden="true" tabindex="-1"></a>        ; fi</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="15">15</button><span id="annotated-cell-6-78" class="code-annotation-target"><a href="#annotated-cell-6-78" aria-hidden="true" tabindex="-1"></a>ONBUILD USER <span class="sc">$</span>{NB_USER}</span>
<span id="annotated-cell-6-79"><a href="#annotated-cell-6-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-80"><a href="#annotated-cell-6-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the conda environment</span></span>
<span id="annotated-cell-6-81"><a href="#annotated-cell-6-81" aria-hidden="true" tabindex="-1"></a><span class="co"># sometimes package solving will get rid of pip installed packages. Make sure jupyter-remote-desktop-proxy does not disappear</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="16">16</button><span id="annotated-cell-6-82" class="code-annotation-target"><a href="#annotated-cell-6-82" aria-hidden="true" tabindex="-1"></a>ONBUILD RUN echo <span class="st">"Checking for 'conda-lock.yml' or 'environment.yml'..."</span> \</span>
<span id="annotated-cell-6-83"><a href="#annotated-cell-6-83" aria-hidden="true" tabindex="-1"></a>        ; cd <span class="st">"${REPO_DIR}/childimage/"</span> \</span>
<span id="annotated-cell-6-84"><a href="#annotated-cell-6-84" aria-hidden="true" tabindex="-1"></a>        ; <span class="cf">if</span> test <span class="sc">-</span>f <span class="st">"conda-lock.yml"</span> ; then echo <span class="st">"Using conda-lock.yml"</span> <span class="sc">&amp;</span> \</span>
<span id="annotated-cell-6-85"><a href="#annotated-cell-6-85" aria-hidden="true" tabindex="-1"></a>        conda<span class="sc">-</span>lock install <span class="sc">--</span>name <span class="sc">$</span>{CONDA_ENV} \</span>
<span id="annotated-cell-6-86"><a href="#annotated-cell-6-86" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> pip install <span class="sc">--</span>no<span class="sc">-</span>deps jupyter<span class="sc">-</span>remote<span class="sc">-</span>desktop<span class="sc">-</span>proxy \</span>
<span id="annotated-cell-6-87"><a href="#annotated-cell-6-87" aria-hidden="true" tabindex="-1"></a>        ; elif test <span class="sc">-</span>f <span class="st">"environment.yml"</span> ; then echo <span class="st">"Using environment.yml"</span> <span class="sc">&amp;</span> \</span>
<span id="annotated-cell-6-88"><a href="#annotated-cell-6-88" aria-hidden="true" tabindex="-1"></a>        mamba env update <span class="sc">--</span>name <span class="sc">$</span>{CONDA_ENV} <span class="sc">-</span>f environment.yml  \</span>
<span id="annotated-cell-6-89"><a href="#annotated-cell-6-89" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> pip install <span class="sc">--</span>no<span class="sc">-</span>deps jupyter<span class="sc">-</span>remote<span class="sc">-</span>desktop<span class="sc">-</span>proxy \</span>
<span id="annotated-cell-6-90"><a href="#annotated-cell-6-90" aria-hidden="true" tabindex="-1"></a>        ; fi \</span>
<span id="annotated-cell-6-91"><a href="#annotated-cell-6-91" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> mamba clean <span class="sc">-</span>yaf \</span>
<span id="annotated-cell-6-92"><a href="#annotated-cell-6-92" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> find <span class="sc">$</span>{CONDA_DIR} <span class="sc">-</span>follow <span class="sc">-</span>type f <span class="sc">-</span>name <span class="st">'*.a'</span> <span class="sc">-</span>delete \</span>
<span id="annotated-cell-6-93"><a href="#annotated-cell-6-93" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> find <span class="sc">$</span>{CONDA_DIR} <span class="sc">-</span>follow <span class="sc">-</span>type f <span class="sc">-</span>name <span class="st">'*.js.map'</span> <span class="sc">-</span>delete \</span>
<span id="annotated-cell-6-94"><a href="#annotated-cell-6-94" aria-hidden="true" tabindex="-1"></a>        ; <span class="cf">if</span> ls <span class="sc">$</span>{NB_PYTHON_PREFIX}<span class="sc">/</span>lib<span class="sc">/</span>python<span class="sc">*</span><span class="er">/</span>site<span class="sc">-</span>packages<span class="sc">/</span>bokeh<span class="sc">/</span>server<span class="sc">/</span>static <span class="sc">&gt;</span> <span class="er">/</span>dev<span class="sc">/</span>null <span class="dv">2</span><span class="sc">&gt;</span><span class="er">&amp;</span><span class="dv">1</span>; then \</span>
<span id="annotated-cell-6-95"><a href="#annotated-cell-6-95" aria-hidden="true" tabindex="-1"></a>        find <span class="sc">$</span>{NB_PYTHON_PREFIX}<span class="sc">/</span>lib<span class="sc">/</span>python<span class="sc">*</span><span class="er">/</span>site<span class="sc">-</span>packages<span class="sc">/</span>bokeh<span class="sc">/</span>server<span class="sc">/</span>static <span class="sc">-</span>follow <span class="sc">-</span>type f <span class="sc">-</span>name <span class="st">'*.js'</span> <span class="sc">!</span> <span class="sc">-</span>name <span class="st">'*.min.js'</span> <span class="sc">-</span>delete \</span>
<span id="annotated-cell-6-96"><a href="#annotated-cell-6-96" aria-hidden="true" tabindex="-1"></a>        ; fi</span>
<span id="annotated-cell-6-97"><a href="#annotated-cell-6-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-98"><a href="#annotated-cell-6-98" aria-hidden="true" tabindex="-1"></a><span class="co"># If a requirements.txt file exists, use pip to install packages</span></span>
<span id="annotated-cell-6-99"><a href="#annotated-cell-6-99" aria-hidden="true" tabindex="-1"></a><span class="co"># listed there. We don't want to save cached wheels in the image</span></span>
<span id="annotated-cell-6-100"><a href="#annotated-cell-6-100" aria-hidden="true" tabindex="-1"></a><span class="co"># to avoid wasting space.</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="17">17</button><span id="annotated-cell-6-101" class="code-annotation-target"><a href="#annotated-cell-6-101" aria-hidden="true" tabindex="-1"></a>ONBUILD RUN echo <span class="st">"Checking for pip 'requirements.txt'..."</span> \</span>
<span id="annotated-cell-6-102"><a href="#annotated-cell-6-102" aria-hidden="true" tabindex="-1"></a>        ; cd <span class="st">"${REPO_DIR}/childimage/"</span> \</span>
<span id="annotated-cell-6-103"><a href="#annotated-cell-6-103" aria-hidden="true" tabindex="-1"></a>        ; <span class="cf">if</span> test <span class="sc">-</span>f <span class="st">"requirements.txt"</span> ; then \</span>
<span id="annotated-cell-6-104"><a href="#annotated-cell-6-104" aria-hidden="true" tabindex="-1"></a>        <span class="sc">$</span>{NB_PYTHON_PREFIX}<span class="sc">/</span>bin<span class="sc">/</span>pip install <span class="sc">--</span>no<span class="sc">-</span>cache <span class="sc">-</span>r requirements.txt \</span>
<span id="annotated-cell-6-105"><a href="#annotated-cell-6-105" aria-hidden="true" tabindex="-1"></a>        ; fi</span>
<span id="annotated-cell-6-106"><a href="#annotated-cell-6-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-107"><a href="#annotated-cell-6-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the r packages</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="18">18</button><span id="annotated-cell-6-108" class="code-annotation-target"><a href="#annotated-cell-6-108" aria-hidden="true" tabindex="-1"></a>ONBUILD RUN echo <span class="st">"Checking for 'install.R"</span> \</span>
<span id="annotated-cell-6-109"><a href="#annotated-cell-6-109" aria-hidden="true" tabindex="-1"></a>        ; cd <span class="st">"${REPO_DIR}/childimage/"</span> \</span>
<span id="annotated-cell-6-110"><a href="#annotated-cell-6-110" aria-hidden="true" tabindex="-1"></a>        ; <span class="cf">if</span> test <span class="sc">-</span>f <span class="st">"install.R"</span> ; then echo <span class="st">"Using install.R"</span> <span class="sc">&amp;</span> \</span>
<span id="annotated-cell-6-111"><a href="#annotated-cell-6-111" aria-hidden="true" tabindex="-1"></a>        Rscript install.R \</span>
<span id="annotated-cell-6-112"><a href="#annotated-cell-6-112" aria-hidden="true" tabindex="-1"></a>        ; fi</span>
<span id="annotated-cell-6-113"><a href="#annotated-cell-6-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-114"><a href="#annotated-cell-6-114" aria-hidden="true" tabindex="-1"></a><span class="co"># If a start file exists, put that under ${REPO_DIR}/childimage/start. </span></span>
<span id="annotated-cell-6-115"><a href="#annotated-cell-6-115" aria-hidden="true" tabindex="-1"></a><span class="co"># This is sourced in ${REPO_DIR}/start</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="19">19</button><span id="annotated-cell-6-116" class="code-annotation-target"><a href="#annotated-cell-6-116" aria-hidden="true" tabindex="-1"></a>ONBUILD RUN echo <span class="st">"Checking for 'start'..."</span> \</span>
<span id="annotated-cell-6-117"><a href="#annotated-cell-6-117" aria-hidden="true" tabindex="-1"></a>        ; cd <span class="st">"${REPO_DIR}/childimage/"</span> \</span>
<span id="annotated-cell-6-118"><a href="#annotated-cell-6-118" aria-hidden="true" tabindex="-1"></a>        ; <span class="cf">if</span> test <span class="sc">-</span>f <span class="st">"start"</span> ; then \</span>
<span id="annotated-cell-6-119"><a href="#annotated-cell-6-119" aria-hidden="true" tabindex="-1"></a>        chmod <span class="sc">+</span>x start \</span>
<span id="annotated-cell-6-120"><a href="#annotated-cell-6-120" aria-hidden="true" tabindex="-1"></a>        ; fi</span>
<span id="annotated-cell-6-121"><a href="#annotated-cell-6-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-122"><a href="#annotated-cell-6-122" aria-hidden="true" tabindex="-1"></a><span class="co"># If a postBuild file exists, run it!</span></span>
<span id="annotated-cell-6-123"><a href="#annotated-cell-6-123" aria-hidden="true" tabindex="-1"></a><span class="co"># After it's done, we try to remove any possible cruft commands there</span></span>
<span id="annotated-cell-6-124"><a href="#annotated-cell-6-124" aria-hidden="true" tabindex="-1"></a><span class="co"># left behind under $HOME - particularly stuff that jupyterlab extensions</span></span>
<span id="annotated-cell-6-125"><a href="#annotated-cell-6-125" aria-hidden="true" tabindex="-1"></a><span class="co"># leave behind.</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="20">20</button><span id="annotated-cell-6-126" class="code-annotation-target"><a href="#annotated-cell-6-126" aria-hidden="true" tabindex="-1"></a>ONBUILD RUN echo <span class="st">"Checking for 'postBuild'..."</span> \</span>
<span id="annotated-cell-6-127"><a href="#annotated-cell-6-127" aria-hidden="true" tabindex="-1"></a>        ; cd <span class="st">"${REPO_DIR}/childimage/"</span> \</span>
<span id="annotated-cell-6-128"><a href="#annotated-cell-6-128" aria-hidden="true" tabindex="-1"></a>        ; <span class="cf">if</span> test <span class="sc">-</span>f <span class="st">"postBuild"</span> ; then \</span>
<span id="annotated-cell-6-129"><a href="#annotated-cell-6-129" aria-hidden="true" tabindex="-1"></a>        chmod <span class="sc">+</span>x postBuild \</span>
<span id="annotated-cell-6-130"><a href="#annotated-cell-6-130" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> .<span class="sc">/</span>postBuild \</span>
<span id="annotated-cell-6-131"><a href="#annotated-cell-6-131" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> rm <span class="sc">-</span>rf <span class="sc">/</span>tmp<span class="sc">/</span><span class="er">*</span> \</span>
<span id="annotated-cell-6-132"><a href="#annotated-cell-6-132" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> rm <span class="sc">-</span>rf <span class="sc">$</span>{HOME}<span class="sc">/</span>.cache <span class="sc">$</span>{HOME}<span class="sc">/</span>.npm <span class="sc">$</span>{HOME}<span class="sc">/</span>.yarn \</span>
<span id="annotated-cell-6-133"><a href="#annotated-cell-6-133" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> rm <span class="sc">-</span>rf <span class="sc">$</span>{NB_PYTHON_PREFIX}<span class="sc">/</span>share<span class="sc">/</span>jupyter<span class="sc">/</span>lab<span class="sc">/</span>staging \</span>
<span id="annotated-cell-6-134"><a href="#annotated-cell-6-134" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> find <span class="sc">$</span>{CONDA_DIR} <span class="sc">-</span>follow <span class="sc">-</span>type f <span class="sc">-</span>name <span class="st">'*.a'</span> <span class="sc">-</span>delete \</span>
<span id="annotated-cell-6-135"><a href="#annotated-cell-6-135" aria-hidden="true" tabindex="-1"></a>        <span class="sc">&amp;&amp;</span> find <span class="sc">$</span>{CONDA_DIR} <span class="sc">-</span>follow <span class="sc">-</span>type f <span class="sc">-</span>name <span class="st">'*.js.map'</span> <span class="sc">-</span>delete \</span>
<span id="annotated-cell-6-136"><a href="#annotated-cell-6-136" aria-hidden="true" tabindex="-1"></a>        ; fi</span>
<span id="annotated-cell-6-137"><a href="#annotated-cell-6-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-138"><a href="#annotated-cell-6-138" aria-hidden="true" tabindex="-1"></a><span class="do">## End ONBUILD section for child images</span></span>
<span id="annotated-cell-6-139"><a href="#annotated-cell-6-139" aria-hidden="true" tabindex="-1"></a><span class="do">################################</span></span>
<span id="annotated-cell-6-140"><a href="#annotated-cell-6-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-141"><a href="#annotated-cell-6-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Revert to default user and home as pwd</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="21">21</button><span id="annotated-cell-6-142" class="code-annotation-target"><a href="#annotated-cell-6-142" aria-hidden="true" tabindex="-1"></a>USER <span class="sc">$</span>{NB_USER}</span>
<span id="annotated-cell-6-143"><a href="#annotated-cell-6-143" aria-hidden="true" tabindex="-1"></a>WORKDIR <span class="sc">$</span>{HOME}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="1" data-code-annotation="1">Some commands need to be run as root, such as installing linux packages with <code>apt-get</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="4" data-code-annotation="2">repo2docker does not set this environment variable and it is useful for child builds</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="7,8,9,10,11,12,13,14" data-code-annotation="3">This section runs the script <code>rocker.sh</code> which installs R and RStudio using rocker scripts.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="16,17,18,19,20,21,22,23" data-code-annotation="4">The rocker scripts build R from source and as part of clean up in the script, linux packages are removed that are not needed. repo2docker installs the packages in <code>apt.txt</code> automatically before the code in <code>appendix</code> thus the needed linux packages (which include packages for desktop) are put in <code>apt2.txt</code> (which repo2docker will not detect) and are installed separately here. The <code>grep -v</code> etc code is processing <code>apt2.txt</code> and removing comments and blank lines.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="27,28,29,30,31,32,33" data-code-annotation="5">Ubuntu does not have man pages installed by default. These lines activate <code>man</code> so users have the common help files.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="36,37" data-code-annotation="6">This is some custom jupyter config to allow hidden files to be listed in the folder browser.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="40" data-code-annotation="7"><code>book</code> and <code>docs</code> are the documentation files and are not needed in the image.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="45" data-code-annotation="8">The <code>NB_USER</code> environmental variable is not exported by repo2docker (it is an argument confined to the parent build) but is very useful for child builds. So it is converted to an environmental variable.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="47" data-code-annotation="9">This next section is a series of <code>ONBUILD</code> commands. These are only run if py-rocker-base is used in the <code>FROM</code> line in a child docker file.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="49" data-code-annotation="10">Set the user to NB_USER. Not strictly necessary but helps ensure that we don’t accidentally create files that jovyan (NB_USER) cannot access.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="11">11</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="53" data-code-annotation="11">Copy the child build context (files with the Docker file) into <code>${REPO_DIR}</code>. Make sure that jovyan owns the directory. Note, jovyan owns <code>${REPO_DIR}</code> (this is set by repo2docker).</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="13">13</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="58,59,60,61,62,63" data-code-annotation="13">The Desktop files are put in a directory called Desktop. Copy them into <code>${REPO_DIR}/Desktop</code>. The start script will copy these into the correct location for the Desktop server.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="14">14</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="67,68,69,70,71,72,73,74,75,76" data-code-annotation="14">If <code>apt.txt</code> is present, then install the packages. The code processes any comments or blank lines in <code>apt.txt</code>. This must be run as root so we switch to root to install.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="15">15</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="78" data-code-annotation="15">Switch back to jovyan so we don’t accidentally make files as belonging to root.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="16">16</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="82,83,84,85,86,87,88,89,90,91,92,93,94,95,96" data-code-annotation="16">If <code>environment.yml</code> is present, install these into the conda environment and do some clean-up. Sometimes package solving will get rid of pip installed packages. We need to make sure that jupyter-remote-desktop-proxy does not disappear.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="17">17</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="101,102,103,104,105" data-code-annotation="17">If <code>requirements.txt</code> is present, install with pip and do some clean-up.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="18">18</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="108,109,110,111,112" data-code-annotation="18"><code>install.R</code> is an R script where the user can specify how to install packages or run any other R code.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="19">19</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="116,117,118,119,120" data-code-annotation="19"><code>start</code> is run in the <code>${REPO_DIR}/start</code> command in a subshell. The <code>${REPO_DIR}/start</code> command cannot be replaced since it contains code to move the Desktop files into the correct place.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="20">20</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="126,127,128,129,130,131,132,133,134,135,136" data-code-annotation="20"><code>postBuild</code> is a script. If present, run it and then do some clean-up. It is common to use <code>postBuild</code> to apply extensions or install packages that cannot be installed with <code>apt</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="21">21</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="142,143" data-code-annotation="21">The parent docker build completes by setting the user to jovyan and the working directory to <code>${HOME}</code>. Within a JupyterHub deployment, <code>${HOME}</code> will often be re-mapped to the user persistent memory so it is important not to write anything that needs to be persistent to <code>${HOME}</code>, for example configuration. You can do this in the <code>start</code> script since that runs after the user directory is mapped or you can put configuration files in some place other than <code>${HOME}</code>.</span>
</dd>
</dl>
</section>
</section>
<section id="rocker.sh" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="rocker.sh"><span class="header-section-number">7.7</span> rocker.sh</h2>
<p>This script will copy in the rocker scripts from <a href="https://github.com/rocker-org/rocker-versioned2">rocker-versioned2</a> into <code>${REPO_DIR}</code> to install things. It will read in one of the rocker docker files using <code>R_DOCKERFILE</code> defined in the <code>appendix</code> file (which is inserted into the main docker file). Variables defined here will only be available in this script. Click on the numbers in the script to learn what each section is doing.</p>
<pre id="annotated-cell-7" class="code-annotation-code"><code>#!/bin/bash
set -e

# Copy in the rocker files. Work in ${REPO_DIR} to make sure I don't clobber anything
cd ${REPO_DIR}
wget https://github.com/rocker-org/rocker-versioned2/archive/refs/tags/R${R_VERSION}.tar.gz
tar zxvf R${R_VERSION}.tar.gz &amp;&amp; \
mv rocker-versioned2-R${R_VERSION}/scripts /rocker_scripts &amp;&amp; \
ROCKER_DOCKERFILE_NAME="${R_DOCKERFILE}.Dockerfile"
mv rocker-versioned2-R${R_VERSION}/dockerfiles/${ROCKER_DOCKERFILE_NAME}  /rocker_scripts/original.Dockerfile &amp;&amp; \
rm R${R_VERSION}.tar.gz &amp;&amp; \
rm -rf rocker-versioned2-R${R_VERSION}

cd /
# Read the Dockerfile and process each line
while IFS= read -r line; do
    # Check if the line starts with ENV or RUN
    if [[ "$line" == ENV* ]]; then
        # Assign variable
        var_assignment=$(echo "$line" | sed 's/^ENV //g')
        # Replace ENV DEFAULT_USER="jovyan"
        if [[ "$var_assignment" == DEFAULT_USER* ]]; then
            var_assignment="DEFAULT_USER=${NB_USER}"
        fi
        # Run this way eval "export ..." otherwise the " will get turned to %22
        eval "export $var_assignment"
        # Write the exported variable to env.txt
        echo "export $var_assignment" &gt;&gt; ${REPO_DIR}/env.txt
    elif [[ "$line" == RUN* ]]; then
        # Run the command from the RUN line
        cmd=$(echo "$line" | sed 's/^RUN //g')
        echo "Executing: $cmd"
        eval "$cmd" # || echo ${cmd}" encountered an error, but continuing..."
    fi
done &lt; /rocker_scripts/original.Dockerfile

# Install extra tex packages that are not installed by default
if command -v tlmgr &amp;&gt; /dev/null; then
    echo "Installing texlive collection-latexrecommended..."
    tlmgr install collection-latexrecommended
    tlmgr install pdfcol tcolorbox eurosym upquote adjustbox titling enumitem ulem soul rsfs
fi</code></pre>
<dl>
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="5,6,7" data-code-annotation="1">The <a href="https://github.com/rocker-org/rocker-versioned2">rocker-versioned2</a> repository for a particular R version is copied into <code>{REPO_DIR}</code> and unzipped. <code>R_VERSION</code> is defined in <code>appendix</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="8" data-code-annotation="2">The unzipped directory will be named <code>rocker-versioned2-R${R_VERSION}</code>. We move the <code>scripts</code> directory to <code>/rocker_scripts</code> (base level) because the rocker scripts expect the scripts to be there.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="9,10" data-code-annotation="3"><code>R_DOCKERFILE</code> is defined as <code>verse_${R_VERSION}</code>. The docker file we will process (find ENV and RUN lines) is called <code>ROCKER_DOCKERFILE_NAME</code> in the rocker files. We move this to <code>/rocker_scripts/original.Dockerfile</code> so we can refer to it later.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="11,12" data-code-annotation="4">Clean up the rocker directories that we no longer need.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="14" data-code-annotation="5">cd to the base level where <code>/rocker_scripts</code> is.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="15,16" data-code-annotation="6">The big while loop is processing <code>/rocker_scripts/original.Dockerfile</code>. The code is using piping <code>&gt;</code> and the input file and pipe is specified at the end of the while loop code.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="17,18,19,20" data-code-annotation="7">This looks if the line starts with <code>ENV</code> and if it does, it strips off <code>ENV</code> and stores the variable assigment statement to <code>$var_assignment</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="21,22,23,24" data-code-annotation="8">The rocker docker files do not use the <code>NB_USER</code> environmental variable (defined in <code>appendix</code>). If the <code>ENV</code> line is defining the default user, we need to change that assignment to the variable <code>NB_USER</code>. This part is specific to the rocker docker files.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="26" data-code-annotation="9">We need to export any variables (<code>ENV</code>) found in the docker file so it is available to the scripts that will run in the <code>RUN</code> statements. We need to export the variables as done here (with <code>eval</code> and <code>export</code>) otherwise they don’t make it to the child scripts about to be run. Getting variables to be exported to child scripts being called by a parent script is tricky and this line required a lot of testing and debugging to get variables exported properly.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="28" data-code-annotation="10">The export line will only make the variable available to the child scripts. We also want them available in the final image. To do that, we write them to a file that we will source from the docker file. Scripts are run in an ephemeral subshell during docker builds so we cannot define the variable here.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="11">11</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="29,30,31,32,33,34" data-code-annotation="11">If the docker file line starts with <code>RUN</code> then run the command. This command should be a rocker script because that is how rocker docker files are organized. See an example <a href="https://github.com/rocker-org/rocker-versioned2/blob/master/dockerfiles/verse_4.4.1.Dockerfile">rocker docker file</a>.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="12">12</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="35" data-code-annotation="12">Here the input file for the while loop is specified.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="13">13</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="37,38,39,40,41,42" data-code-annotation="13">The rocker <code>install_texlive.sh</code> script (which is part of verse) will provide a basic texlive installation. Here a few more packages are added so that the user is able to run vanilla Quarto to PDF and Myst to PDF. See the <a href="tex.html">chapter on texlive</a>.</span>
</dd>
</dl>
</section>
<section id="start" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="start"><span class="header-section-number">7.8</span> start</h2>
<p>Within a JupyterHub, the user home directory <code>$HOME</code> is typically re-mapped to the user persistent home directory. That means that the image build process cannot put things into <code>$HOME</code>, they would just be lost when <code>$HOME</code> is re-mapped. If a process needs to have something in the home directory, e.g.&nbsp;in some local user configuration, this must be done in the <code>start</code> script. The repo2docker docker image specifies that the start script is <code>${REPO_DIR}/start</code>.</p>
<p>For py-rocket-base, the start script is used to move the Desktop files (<code>*.desktop</code>) to where the Desktop server expects them, which is <code>${HOME}/.local/share/applications/</code> and <code>${HOME}/Desktop</code>. Any <code>*.desktop</code> files found there will appear as clickable icons in <code>\desktop</code>. This must be done in start, since the files need to be put in <code>${HOME}</code> which not available until after the server starts.</p>
<pre id="annotated-cell-8" class="code-annotation-code"><code>#!/bin/bash
set -euo pipefail

# Start - Set any environment variables here
# These are inherited by all processes, *except* RStudio
# USE export &lt;parname&gt;=value
# Tell applications where to open desktop apps - this allows notebooks to pop open GUIs
export DISPLAY=":1.0"
# source this file to get the variables defined in the rocker Dockerfile
source ${REPO_DIR}/env.txt
# End - Set any environment variables here

# The for loops will fail if they return null (no files). Set shell option nullglob
shopt -s nullglob

# Add any .desktop files to the application database and desktop. This is done
# at startup-time because it's expected that a remote filesystem will be
# mounted at $HOME, which would overwrite the data if it was created at
# build-time.
APPLICATIONS_DIR="${HOME}/.local/share/applications"
DESKTOP_DIR="${HOME}/Desktop"
# Remove DESKTOP_DIR if it exists to avoid leftover files
if [ -d "${DESKTOP_DIR}" ]; then
    rm -rf "${DESKTOP_DIR}"
fi
mkdir -p "${APPLICATIONS_DIR}"
mkdir -p "${DESKTOP_DIR}"
for desktop_file_path in ${REPO_DIR}/Desktop/*.desktop; do
    cp "${desktop_file_path}" "${APPLICATIONS_DIR}/."

    # Symlink application to desktop and set execute permission so xfce (desktop) doesn't complain
    desktop_file_name="$(basename ${desktop_file_path})"
    # Set execute permissions on the copied .desktop file
    chmod +x "${APPLICATIONS_DIR}/${desktop_file_name}"
    ln -sf "${APPLICATIONS_DIR}/${desktop_file_name}" "${DESKTOP_DIR}/${desktop_file_name}"
done
update-desktop-database "${APPLICATIONS_DIR}"

# Add MIME Type data from XML files  to the MIME database.
MIME_DIR="${HOME}/.local/share/mime"
MIME_PACKAGES_DIR="${MIME_DIR}/packages"
mkdir -p "${MIME_PACKAGES_DIR}"
for mime_file_path in ${REPO_DIR}/Desktop/*.xml; do
    cp "${mime_file_path}" "${MIME_PACKAGES_DIR}/."
done
update-mime-database "${MIME_DIR}"

# Run child start in a subshell to contain its environment
[ -f ${REPO_DIR}/childimage/start ] &amp;&amp; ( source ${REPO_DIR}/childimage/start )

exec "$@"</code></pre>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nmfs-opensci\.github\.io\/py-rocket-base");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./jupyter-config.html" class="pagination-link" aria-label="Customizing Jupyter">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Customizing Jupyter</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/nmfs-opensci/py-rocket-base/edit/main/developers.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/nmfs-opensci/py-rocket-base/blob/main/developers.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/nmfs-opensci/py-rocket-base/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>